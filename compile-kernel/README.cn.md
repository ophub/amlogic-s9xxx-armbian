# ç¼–è¯‘å†…æ ¸

æŸ¥çœ‹è‹±æ–‡è¯´æ˜ | [View English description](README.md)

æ ¹æ®éœ€è¦ï¼Œç¼–è¯‘è‡ªå®šä¹‰å†…æ ¸ã€‚æ­¤å†…æ ¸å¯ç”¨äº [Armbian](https://github.com/ophub/amlogic-s9xxx-armbian) å’Œ [OpenWrt](https://github.com/ophub/amlogic-s9xxx-openwrt) ç³»ç»Ÿï¼Œåœ¨ä»¥ [flippy](https://github.com/unifreq/openwrt_packit) æ ‡å‡†åˆ¶ä½œçš„åŒç±»ç³»ç»Ÿä¸­å¯é€šç”¨ã€‚

## ç¼–è¯‘å‘½ä»¤è¯´æ˜

- `sudo ./recompile -k 5.4.160` : é€šè¿‡ -k è¿›è¡ŒæŒ‡å®šéœ€è¦ç¼–è¯‘çš„å†…æ ¸ç‰ˆæœ¬ï¼Œå¤šä¸ªç‰ˆæœ¬åŒæ—¶ç¼–è¯‘æ—¶ä½¿ç”¨ `_` è¿›è¡Œè¿æ¥ã€‚
- `sudo ./recompile -k 5.4.160 -a true` : é€šè¿‡ -a å‚æ•°è®¾ç½®ç¼–è¯‘å†…æ ¸æ—¶ï¼Œæ˜¯å¦è‡ªåŠ¨å‡çº§åˆ°åŒç³»åˆ—æœ€æ–°å†…æ ¸ã€‚
- `sudo ./recompile -k 5.4.160 -n leifeng` : é€šè¿‡ -n å‚æ•°è®¾ç½®å†…æ ¸è‡ªå®šä¹‰ç­¾åã€‚
- `sudo ./recompile -k 5.4.160 -r kernel.org` : é€šè¿‡ -r å‚æ•°è®¾ç½®ç¼–è¯‘æºç çš„ä¸‹è½½ç«™ã€‚
- `sudo ./recompile -k 5.10.80_5.4.160 -a true -n leifeng -r kernel.org` : é€šè¿‡å¤šä¸ªå‚æ•°è¿›è¡Œè®¾ç½®ã€‚

| å‚æ•° | å«ä¹‰ | è¯´æ˜ |
| ---- | ---- | ---- |
| -k | Kernel | æŒ‡å®š [kernel](https://cdn.kernel.org/pub/linux/kernel/v5.x/) åç§°ï¼Œå¦‚ `-k 5.4.160` . å¤šä¸ªå†…æ ¸ä½¿ç”¨ `_` è¿›è¡Œè¿æ¥ï¼Œå¦‚ `-k 5.10.80_5.4.160` |
| -a | AutoKernel | è®¾ç½®æ˜¯å¦è‡ªåŠ¨é‡‡ç”¨åŒç³»åˆ—æœ€æ–°ç‰ˆæœ¬å†…æ ¸ã€‚å½“ä¸º `true` æ—¶ï¼Œå°†è‡ªåŠ¨æŸ¥æ‰¾åœ¨ `-k` ä¸­æŒ‡å®šçš„å†…æ ¸å¦‚ `5.4.160` çš„ `5.4` åŒç³»åˆ—æ˜¯å¦æœ‰æ›´æ–°çš„ç‰ˆæœ¬ï¼Œå¦‚æœ‰ `5.4.160` ä¹‹åçš„æœ€æ–°ç‰ˆæœ¬æ—¶ï¼Œå°†è‡ªåŠ¨æ›´æ¢ä¸ºæœ€æ–°ç‰ˆã€‚è®¾ç½®ä¸º `false` æ—¶å°†ç¼–è¯‘æŒ‡å®šç‰ˆæœ¬å†…æ ¸ã€‚é»˜è®¤å€¼ï¼š`true` |
| -n | CustomName | è®¾ç½®å†…æ ¸è‡ªå®šä¹‰ç­¾åã€‚é»˜è®¤å€¼ä¸º `-meson64-beta` ï¼Œç”Ÿæˆçš„å†…æ ¸åç§°ä¸º `5.4.160-meson64-beta` ã€‚è®¾ç½®è‡ªå®šä¹‰ç­¾åæ—¶è¯·å‹¿åŒ…å«ç©ºæ ¼ã€‚ |
| -r | Repo | æŒ‡å®šå†…æ ¸ç¼–è¯‘æºç çš„ä¸‹è½½ç«™ã€‚å¯é€‰é¡¹ä¸º [kernel.org](https://www.kernel.org/) å’Œ [flippy](https://github.com/unifreq) ï¼Œé»˜è®¤ä¸º `flippy` |

ğŸ’¡æç¤ºï¼šå¯ä»¥ä½¿ç”¨ `flippy` çš„ [.config](https://github.com/unifreq/arm64-kernel-configs) æ¨¡æ¿å’Œæºç ç¼–è¯‘ [5.4](https://github.com/unifreq/linux-5.4.y) / [5.10](https://github.com/unifreq/linux-5.10.y) / [5.12](https://github.com/unifreq/linux-5.12.y) / [5.13](https://github.com/unifreq/linux-5.13.y) / [5.14](https://github.com/unifreq/linux-5.14.y) / [5.15](https://github.com/unifreq/linux-5.15.y) çš„ `æœ€æ–°ç‰ˆæœ¬` ã€‚`å…¶ä»–ç³»åˆ—æˆ–å†å²ç‰ˆæœ¬` å¯ä»¥ä½¿ç”¨ [kernel.org](https://cdn.kernel.org/pub/linux/kernel/v5.x/) ç¼–è¯‘ã€‚

- ### ä½¿ç”¨ GitHub Action è¿›è¡Œç¼–è¯‘

1. å…³äº Workflows æ–‡ä»¶çš„é…ç½®åœ¨ [.yml](https://github.com/ophub/amlogic-s9xxx-armbian/tree/main/.github/workflows) æ–‡ä»¶é‡Œã€‚

2. åœ¨ [Action](https://github.com/ophub/amlogic-s9xxx-armbian/actions) é¡µé¢é‡Œé€‰æ‹© ***`Compile the armbian kernel`*** ï¼Œç‚¹å‡» ***`Run workflow`*** æŒ‰é’®å³å¯ç¼–è¯‘ã€‚

- ### æœ¬åœ°ç¼–è¯‘

1. è¯·åœ¨ä½ çš„ç›’å­ä¸­å®‰è£… Armbian ç³»ç»Ÿï¼Œå¹¶å®‰è£…ä»¥ä¸‹ä¾èµ–ç¯å¢ƒã€‚

```yaml
sudo apt-get update -y
sudo apt-get full-upgrade -y
sudo apt-get install -y $(curl -fsSL git.io/armbian-kernel-server)
```

2. å…‹éš†ä»“åº“åˆ°æœ¬åœ° `git clone --depth 1 https://github.com/ophub/amlogic-s9xxx-armbian.git`

3. é¦–å…ˆåœ¨ `~/amlogic-s9xxx-armbian/compile-kernel` ç›®å½•ä¸‹åˆ›å»º `kernle` ç›®å½•ï¼Œç”¨äºå­˜æ”¾ç¼–è¯‘çš„å†…æ ¸æºç ã€‚å¦‚é‡‡ç”¨ [kernel.org](https://cdn.kernel.org/pub/linux/kernel/v5.x/) çš„æºç è¿›è¡Œç¼–è¯‘ï¼Œè¯·ä¸‹è½½å¯¹åº”çš„å†…æ ¸å¦‚ `linux-5.4.160.tar.xz` å¹¶è§£å‹åˆ°å¯¹åº”çš„ `compile-kernel/kernle/linux-5.4.160` ç›®å½•ä¸‹ï¼›å¦‚é‡‡ç”¨ [flippy](https://github.com/unifreq) çš„æºç è¿›è¡Œç¼–è¯‘ï¼Œè¯·å…‹éš†æŒ‡å®šå†…æ ¸ç³»åˆ—çš„æºç å¦‚ `git clone --depth 1 https://github.com/unifreq/linux-5.4.y compile-kernel/kernle/linux-5.4.y` åˆ°å¯¹åº”çš„ç›®å½•ä¸‹ã€‚å®Œæˆåè¿›å…¥å¯¹åº”çš„å†…æ ¸å¦‚ `compile-kernel/kernle/linux-5.4.160` çš„ç›®å½•ä¸‹ï¼Œè¿è¡Œä¸ªæ€§åŒ–é…ç½®é€‰æ‹©å‘½ä»¤ `make menuconfig` è¿›è¡Œé€‰æ‹©ï¼Œå®Œæˆåä¿å­˜ï¼Œä¼šåœ¨å†…æ ¸ç›®å½•ä¸‹ç”Ÿæˆè‡ªå®šä¹‰çš„å†…æ ¸ `.config` é…ç½®æ–‡ä»¶ã€‚

4. è¿›å…¥ `~/amlogic-s9xxx-armbian` æ ¹ç›®å½•ï¼Œç„¶åè¿è¡Œ `sudo ./recompile -k 5.4.160` å‘½ä»¤å³å¯ç¼–è¯‘å†…æ ¸ã€‚æ‰“åŒ…å¥½çš„å†…æ ¸æ–‡ä»¶ä¿å­˜åœ¨ `compile-kernel/output` ç›®å½•é‡Œã€‚

## å…¶ä»–è¯´æ˜

1. å†…æ ¸ç¼–è¯‘æ–‡ä»¶æ£€æŸ¥çš„ä¼˜å…ˆçº§ï¼šå¦‚æœ `compile-kernel/kernle` ç›®å½•ä¸‹æœ‰æŒ‡å®šå†…æ ¸çš„æ–‡ä»¶å¤¹å¦‚ `linux-5.4.160` æ—¶ï¼Œå°†ä½¿ç”¨æœ¬åœ°æºç è¿›è¡Œç¼–è¯‘ï¼›å½“æ²¡æœ‰æŒ‡å®šå†…æ ¸çš„æ–‡ä»¶å¤¹ï¼Œä½†æœ‰æŒ‡å®šå†…æ ¸çš„å‹ç¼©æ–‡ä»¶å¦‚ linux-5.4.160.tar.xz æ—¶ï¼Œå°†è‡ªåŠ¨è§£å‹å¹¶è¿›è¡Œç¼–è¯‘ï¼›å½“æœ¬åœ°æ²¡æœ‰æŒ‡å®šå†…æ ¸æ—¶ï¼Œå°†è‡ªåŠ¨ä»æœåŠ¡å™¨ä¸‹è½½å¹¶ç¼–è¯‘ã€‚

2. å¦‚æœæœ¬åœ°çš„å†…æ ¸ç›®å½•å¦‚ `compile-kernel/kernle/linux-5.4.160` ä¸­æ²¡æœ‰ [.config](tools/config) æ–‡ä»¶ï¼Œå°†è‡ªåŠ¨ä» flippy åˆ†äº«çš„æ¨¡æ¿ä¸­å¤åˆ¶ç›¸åŒå†…æ ¸ç³»åˆ—çš„é…ç½®æ–‡ä»¶ã€‚

3. å¦‚æœåœ¨ `x86_64` çš„ç¯å¢ƒä¸‹ä½¿ç”¨ `Ubuntu` ç­‰ç³»ç»Ÿè¿›è¡Œå†…æ ¸ç¼–è¯‘ï¼Œç”±äºäº¤å‰ç¼–è¯‘ `Armbian` å†…æ ¸æ—¶æ— æ³•ç”Ÿæˆ [uInitrd](tools/uInitrd) æ–‡ä»¶ï¼Œåœ¨æ‰“åŒ…å†…æ ¸æ–‡ä»¶æ—¶ï¼Œå°†è‡ªåŠ¨ä½¿ç”¨ä»“åº“ä¸­çš„ç›¸åŒå†…æ ¸ç³»åˆ—çš„æ–‡ä»¶è¿›è¡Œæ›¿ä»£ã€‚ç›®å‰ï¼Œåœ¨ `x86_64` ç¯å¢ƒä¸‹çš„äº¤å‰ç¼–è¯‘è¿˜ä¸èƒ½å®Œå…¨ä»£æ›¿çœŸå® `Armbian` ç¯å¢ƒä¸‹çš„å†…æ ¸ç¼–è¯‘ï¼Œåˆ¶ä½œçš„å†…æ ¸å­˜åœ¨ä¸ç¨³å®šæ€§ã€‚

4. å†…æ ¸ç¼–è¯‘å®Œæˆåï¼Œå°†ä¼šæŒ‰ç…§ flippy åˆ†äº«çš„å†…æ ¸æ–‡ä»¶çš„ç»„ç»‡æ–¹å¼è‡ªåŠ¨æ‰“åŒ…æˆ 5 ä¸ªå†…æ ¸æ–‡ä»¶ï¼Œå¹¶å­˜æ”¾åœ¨ `compile-kernel/output` ç›®å½•ä¸‹ã€‚è¿™äº›å†…æ ¸æ–‡ä»¶ä¼šè‡ªåŠ¨ä»å½“å‰å†…æ ¸ç¼–è¯‘çš„ Armbian ç³»ç»Ÿä¸­æ¸…é™¤ã€‚å¦‚æœä½ æƒ³åœ¨å½“å‰ç³»ç»Ÿå®‰è£…ï¼Œå¯è¿›å…¥å¯¹åº”çš„å†…æ ¸ç›®å½•å¦‚ `compile-kernel/output/5.4.160` ä¸‹ï¼Œæ‰§è¡ŒæŒ‡å®šå†…æ ¸å®‰è£…å‘½ä»¤å¦‚ `armbian-update 5.4.160` è¿›è¡Œå®‰è£…ã€‚å†…æ ¸ä¸­çš„ `headers` æ–‡ä»¶é»˜è®¤å®‰è£…åœ¨ `/use/local/include` ç›®å½•ä¸‹ã€‚

5. å¦‚æœå½“å‰ `Armbian` ç³»ç»Ÿä¸­å·²ç»å®‰è£…äº†ç›¸åŒåç§°çš„å†…æ ¸å¦‚ `5.4.160-meson64-beta` ï¼Œå°†ä¼šè‡ªåŠ¨åœæ­¢ç¼–è¯‘ï¼Œå› ä¸ºæ‰“åŒ…æ—¶ä¼šåˆ é™¤æœ¬åœ°ç›¸åŒåç§°çš„å†…æ ¸æ–‡ä»¶ï¼Œè¿™ä¹ˆåšä¼šé€ æˆç³»ç»Ÿç˜«ç—ªã€‚

6. å››é¡¹åŸºæœ¬åŸåˆ™ï¼šåœ¨å†…æ ¸æµ‹è¯•æ—¶ï¼Œè¯·åœ¨ `USB/TF` è®¾å¤‡ä¸Šè¿›è¡Œæµ‹è¯•ï¼Œè¯·ä¸è¦è´¸ç„¶å†™å…¥ `EMMC` åˆ†åŒºï¼Œé¿å…æˆç –ï¼›åœ¨æ²¡æœ‰ç†Ÿç»ƒåœ°æŒæ¡æ•‘ç –æ–¹æ³•ä¹‹å‰ï¼Œè¯·ä¸è¦è¿›è¡Œè‡ªå®šä¹‰å†…æ ¸æµ‹è¯•ï¼›è¯·ä¸è¦åœ¨æ­£å¼ç”Ÿäº§ç¯å¢ƒä¸­æµ‹è¯•è‡ªå®šä¹‰å†…æ ¸ï¼›ç†Ÿç»ƒåœ°ä½¿ç”¨ [ç¨³å®šç‰ˆå†…æ ¸](https://github.com/ophub/kernel/tree/main/pub/stable) ï¼Œèƒ½æœ‰æ•ˆåœ°é¿å…è¢«è€æ¿ç½šé’±ï¼Œè¢«è€å©†ç½šç«™ã€‚

