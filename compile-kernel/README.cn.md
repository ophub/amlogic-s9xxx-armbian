# ç¼–è¯‘å†…æ ¸

æŸ¥çœ‹è‹±æ–‡è¯´æ˜ | [View English description](README.md)

æ ¹æ®éœ€è¦ï¼Œç¼–è¯‘è‡ªå®šä¹‰å†…æ ¸ã€‚æ­¤å†…æ ¸å¯ç”¨äº [Armbian](https://github.com/ophub/amlogic-s9xxx-armbian) å’Œ [OpenWrt](https://github.com/ophub/amlogic-s9xxx-openwrt) ç³»ç»Ÿï¼Œåœ¨ä»¥ [unifreq](https://github.com/unifreq/openwrt_packit) æ ‡å‡†åˆ¶ä½œçš„åŒç±»ç³»ç»Ÿä¸­å¯é€šç”¨ã€‚

## æœ¬åœ°ç¼–è¯‘å‘½ä»¤è¯´æ˜

| å‚æ•° | å«ä¹‰ | è¯´æ˜ |
| ---- | ---- | ---- |
| -d | Defaults | ä½¿ç”¨é»˜è®¤é…ç½® |
| -k | Kernel | æŒ‡å®š [kernel](https://cdn.kernel.org/pub/linux/kernel/v5.x/) åç§°ï¼Œå¦‚ `-k 5.4.170` . å¤šä¸ªå†…æ ¸ä½¿ç”¨ `_` è¿›è¡Œè¿æ¥ï¼Œå¦‚ `-k 5.10.90_5.4.170` |
| -a | AutoKernel | è®¾ç½®æ˜¯å¦è‡ªåŠ¨é‡‡ç”¨åŒç³»åˆ—æœ€æ–°ç‰ˆæœ¬å†…æ ¸ã€‚å½“ä¸º `true` æ—¶ï¼Œå°†è‡ªåŠ¨æŸ¥æ‰¾åœ¨ `-k` ä¸­æŒ‡å®šçš„å†…æ ¸å¦‚ `5.4.170` çš„ `5.4` åŒç³»åˆ—æ˜¯å¦æœ‰æ›´æ–°çš„ç‰ˆæœ¬ï¼Œå¦‚æœ‰ `5.4.170` ä¹‹åçš„æœ€æ–°ç‰ˆæœ¬æ—¶ï¼Œå°†è‡ªåŠ¨æ›´æ¢ä¸ºæœ€æ–°ç‰ˆã€‚è®¾ç½®ä¸º `false` æ—¶å°†ç¼–è¯‘æŒ‡å®šç‰ˆæœ¬å†…æ ¸ã€‚é»˜è®¤å€¼ï¼š`true` |
| -n | CustomName | è®¾ç½®å†…æ ¸è‡ªå®šä¹‰ç­¾åã€‚é»˜è®¤å€¼ä¸º `-meson64-dev` ï¼Œç”Ÿæˆçš„å†…æ ¸åç§°ä¸º `5.4.170-meson64-dev` ã€‚è®¾ç½®è‡ªå®šä¹‰ç­¾åæ—¶è¯·å‹¿åŒ…å«ç©ºæ ¼ã€‚ |
| -r | Repo | æŒ‡å®šç¼–è¯‘å†…æ ¸çš„æºä»£ç ä»“åº“ã€‚é»˜è®¤ä¸º `unifreq` ã€‚å¯é€‰æ‹© `kernel.org` çš„æºç å’Œ `github.com` çš„å†…æ ¸æºä»£ç ä»“åº“ã€‚ä¾‹å¦‚ `-r kernel.org` æˆ– `-r unifreq` ç­‰ã€‚å½“ä½¿ç”¨ `github.com` çš„å†…æ ¸æºä»£ç ä»“åº“æ—¶ï¼Œå¯è®¾ç½®å‚æ•°æ ¼å¼ä¸º `owner/repo@branch` ä¸‰é¡¹ç»„åˆï¼Œå‚æ•°ä¸­çš„æ‰€æœ‰è€…åç§° `owner` ä¸ºå¿…é€‰å‚æ•°ï¼Œå†…æ ¸æºä»£ç ä»“åº“åç§° `/repo` å’Œ ä»“åº“çš„åˆ†æ”¯åç§° `@branch` ä¸ºå¯é€‰å‚æ•°ã€‚å½“ä»…æŒ‡å®šæ‰€æœ‰è€…åç§° `owner` å‚æ•°æ—¶ï¼Œå°†è‡ªåŠ¨åŒ¹é…æ‰€æœ‰è€…çš„åç§°ä¸º `linux-5.x.y` æ ¼å¼ä¸”åˆ†æ”¯ä¸º `main` çš„å†…æ ¸æºä»£ç ä»“åº“ã€‚å¦‚æœä»“åº“åç§°æˆ–åˆ†æ”¯åç§°ä¸åŒï¼Œè¯·ä½¿ç”¨ç»„åˆæ–¹å¼æŒ‡å®šï¼Œå¦‚ `owner@branch` æˆ– `owner/repo` æˆ– `owner/repo@branch` |

- `sudo ./recompile -d` : ä½¿ç”¨é»˜è®¤é…ç½®ç¼–è¯‘å†…æ ¸ã€‚
- `sudo ./recompile -d -k 5.4.170` : ä½¿ç”¨é»˜è®¤é…ç½®ï¼Œå¹¶é€šè¿‡ `-k` è¿›è¡ŒæŒ‡å®šéœ€è¦ç¼–è¯‘çš„å†…æ ¸ç‰ˆæœ¬ï¼Œå¤šä¸ªç‰ˆæœ¬åŒæ—¶ç¼–è¯‘æ—¶ä½¿ç”¨ `_` è¿›è¡Œè¿æ¥ã€‚
- `sudo ./recompile -d -k 5.4.170 -a true` : ä½¿ç”¨é»˜è®¤é…ç½®ï¼Œå¹¶é€šè¿‡ `-a` å‚æ•°è®¾ç½®ç¼–è¯‘å†…æ ¸æ—¶ï¼Œæ˜¯å¦è‡ªåŠ¨å‡çº§åˆ°åŒç³»åˆ—æœ€æ–°å†…æ ¸ã€‚
- `sudo ./recompile -d -k 5.4.170 -n -xiaoming` : ä½¿ç”¨é»˜è®¤é…ç½®ï¼Œå¹¶é€šè¿‡ `-n` å‚æ•°è®¾ç½®å†…æ ¸è‡ªå®šä¹‰ç­¾åã€‚
- `sudo ./recompile -d -k 5.4.170 -r kernel.org` : ä½¿ç”¨é»˜è®¤é…ç½®ï¼Œå¹¶é€šè¿‡ `-r` å‚æ•°è®¾ç½®å†…æ ¸æºä»£ç ä»“åº“ã€‚
- `sudo ./recompile -d -k 5.10.90_5.4.170 -a true -n -xiaoming -r kernel.org` : ä½¿ç”¨é»˜è®¤é…ç½®ï¼Œå¹¶é€šè¿‡å¤šä¸ªå‚æ•°è¿›è¡Œè®¾ç½®ã€‚

ğŸ’¡æç¤ºï¼šæ¨èä½¿ç”¨ `unifreq` çš„ [.config](https://github.com/unifreq/arm64-kernel-configs) æ¨¡æ¿å’Œæºç ç¼–è¯‘ [5.4](https://github.com/unifreq/linux-5.4.y) / [5.10](https://github.com/unifreq/linux-5.10.y) / [5.15](https://github.com/unifreq/linux-5.15.y) ç­‰å†…æ ¸çš„ `æœ€æ–°ç‰ˆæœ¬` ã€‚`å…¶ä»–ç³»åˆ—æˆ–å†å²ç‰ˆæœ¬` å¯ä»¥ä½¿ç”¨ [kernel.org](https://cdn.kernel.org/pub/linux/kernel/v5.x/) ç¼–è¯‘ã€‚ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨å…¶ä»–å†…æ ¸æºä»£ç ä»“åº“ã€‚

- ### æœ¬åœ°ç¼–è¯‘

1. å®‰è£…å¿…è¦çš„è½¯ä»¶åŒ…ï¼ˆè„šæœ¬ä»…åœ¨ Ubuntu-20.04-x86_64 ä¸‹åšè¿‡æµ‹è¯•ï¼‰

```yaml
sudo apt-get update -y
sudo apt-get full-upgrade -y
sudo apt-get install -y $(curl -fsSL git.io/ubuntu-2004-server)
```

2. å…‹éš†ä»“åº“åˆ°æœ¬åœ° `git clone --depth 1 https://github.com/ophub/amlogic-s9xxx-armbian.git`

3. è¿›å…¥ `~/amlogic-s9xxx-armbian` æ ¹ç›®å½•ï¼Œç„¶åè¿è¡Œ `sudo ./recompile -d -k 5.4.170` ç­‰æŒ‡å®šå‚æ•°å‘½ä»¤å³å¯ç¼–è¯‘å†…æ ¸ã€‚è„šæœ¬ä¼šè‡ªåŠ¨ä¸‹è½½å®‰è£…ç¼–è¯‘ç¯å¢ƒå’Œå†…æ ¸æºç å¹¶åšå¥½å…¨éƒ¨è®¾ç½®ã€‚æ‰“åŒ…å¥½çš„å†…æ ¸æ–‡ä»¶ä¿å­˜åœ¨ `compile-kernel/output` ç›®å½•é‡Œã€‚å¯ä»¥å°†è¿™äº›å†…æ ¸æ–‡ä»¶ä¸Šä¼ åˆ° `Armbian` ç³»ç»Ÿä»»æ„ç›®å½•ï¼Œå¦‚ `/opt/5.4.170` ç›®å½•ä¸‹ï¼Œå¹¶åœ¨æ­¤å†…æ ¸ç›®å½•å†…æ‰§è¡Œ `armbian-update` å‘½ä»¤è¿›è¡Œå†…æ ¸å®‰è£…ã€‚

- ### ä½¿ç”¨ GitHub Action è¿›è¡Œç¼–è¯‘

1. å…³äº Workflows æ–‡ä»¶çš„é…ç½®åœ¨ [.yml](https://github.com/ophub/amlogic-s9xxx-armbian/tree/main/.github/workflows) æ–‡ä»¶é‡Œã€‚

2. åœ¨ [Action](https://github.com/ophub/amlogic-s9xxx-armbian/actions) é¡µé¢é‡Œé€‰æ‹© ***`Compile the armbian kernel`*** ï¼Œç‚¹å‡» ***`Run workflow`*** æŒ‰é’®å³å¯ç¼–è¯‘ã€‚

- ### ä»…å•ç‹¬å¼•å…¥ GitHub Action ç¼–è¯‘å†…æ ¸

å¯ä»¥åœ¨ä½ çš„ github.com ä»“åº“ä¸­é€šè¿‡ Actions è°ƒç”¨æœ¬ä»“åº“çš„å†…æ ¸ç¼–è¯‘è„šæœ¬ï¼Œåˆ¶ä½œä¸ªæ€§åŒ–å†…æ ¸ã€‚è¯¦è§ä½¿ç”¨æ¨¡æ¿ [compile-kernel.yml](https://github.com/ophub/amlogic-s9xxx-openwrt/blob/main/.github/workflows/compile-kernel.yml) ã€‚ä»£ç å¦‚ä¸‹:

```yaml
- name: Compile the kernel for Amlogic s9xxx
  uses: ophub/amlogic-s9xxx-armbian@main
  with:
    build_target: kernel
    kernel_version: 5.10.90_5.4.170
    kernel_auto: true
    kernel_sign: -meson64-dev
```

- GitHub Action è¾“å…¥å‚æ•°è¯´æ˜

ç›¸å…³å‚æ•°ä¸`æœ¬åœ°ç¼–è¯‘å‘½ä»¤`ç›¸å¯¹åº”ï¼Œè¯·å‚è€ƒä¸Šé¢çš„è¯´æ˜ã€‚

| å‚æ•°               | é»˜è®¤å€¼           | è¯´æ˜                                                      |
|-------------------|-----------------|-----------------------------------------------------------|
| build_target      | kernel          | å›ºå®šå‚æ•° `kernel`ï¼Œè®¾ç½®ç¼–è¯‘ç›®æ ‡ä¸ºå†…æ ¸ã€‚                        |
| kernel_repo       | unifreq         | æŒ‡å®šç¼–è¯‘å†…æ ¸çš„æºä»£ç ä»“åº“ã€‚é»˜è®¤å€¼ä¸º `unifreq` ã€‚åŠŸèƒ½å‚è€ƒ `-r`      |
| kernel_version    | 5.10.90_5.4.170 | æŒ‡å®š [kernel](https://cdn.kernel.org/pub/linux/kernel/v5.x/) åç§°ï¼Œå¦‚ `5.4.170`ã€‚åŠŸèƒ½å‚è€ƒ `-k` |
| kernel_auto       | true            | è®¾ç½®æ˜¯å¦è‡ªåŠ¨é‡‡ç”¨åŒç³»åˆ—æœ€æ–°ç‰ˆæœ¬å†…æ ¸ã€‚é»˜è®¤å€¼ä¸º `true`ã€‚åŠŸèƒ½å‚è€ƒ `-a`  |
| kernel_sign       | -meson64-dev    | è®¾ç½®å†…æ ¸è‡ªå®šä¹‰ç­¾åã€‚é»˜è®¤å€¼ä¸º `-meson64-dev`ã€‚åŠŸèƒ½å‚è€ƒ `-n`       |
| kernel_config     | æ—               | é»˜è®¤å€¼ä½¿ç”¨ [compile-kernel/tools/config](tools/config) ç›®å½•ä¸‹çš„é…ç½®æ¨¡æ¿ã€‚ä½ å¯ä»¥è®¾ç½®ç¼–è¯‘å†…æ ¸çš„é…ç½®æ–‡ä»¶åœ¨ä½ ä»“åº“ä¸­çš„å­˜æ”¾ç›®å½•ï¼Œå¦‚ `kernel/config_path` ã€‚åœ¨æ­¤ç›®å½•ä¸‹å­˜æ”¾çš„å„ç³»åˆ—çš„å†…æ ¸é…ç½®æ¨¡æ¿éƒ½å¿…é¡»ä»¥ `config-5.x` çš„åç§°ä¸ºå¼€å¤´ï¼Œä¾‹å¦‚ç¼–è¯‘ `5.4` ç³»åˆ—å†…æ ¸çš„æ¨¡æ¿å¯å‘½åä¸ºä»¥ `config-5.4` å¼€å¤´çš„å„ç§åå­—ï¼Œå¦‚ `config-5.4` ã€ `config-5.4.174` æˆ–è€… `config-5.4.174-xiaoming` ç­‰ï¼Œæœ‰å¤šä¸ªä»¥ `config-5.4` ä¸ºå¼€å¤´çš„æ–‡ä»¶æ—¶ï¼Œå°†ä½¿ç”¨ç‰ˆæœ¬å·æœ€å¤§çš„æ–‡ä»¶ã€‚ |

- GitHub Action è¾“å‡ºå˜é‡è¯´æ˜

| å‚æ•°                               | é»˜è®¤å€¼                    | è¯´æ˜                       |
|-----------------------------------|--------------------------|----------------------------|
| ${{ env.PACKAGED_OUTPUTTAGS }}    | 5.10.90_5.4.170          | ç¼–è¯‘å¥½çš„å†…æ ¸çš„åç§°            |
| ${{ env.PACKAGED_OUTPUTPATH }}    | compile-kernel/output    | ç¼–è¯‘å®Œæˆçš„å†…æ ¸æ‰€åœ¨æ–‡ä»¶å¤¹çš„è·¯å¾„  |
| ${{ env.PACKAGED_OUTPUTDATE }}    | 2021.04.13.1058          | ç¼–è¯‘æ—¥æœŸ                    |
| ${{ env.PACKAGED_STATUS }}        | success                  | ç¼–è¯‘çŠ¶æ€ï¼šsuccess / failure  |

